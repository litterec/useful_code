var browse_wishlist_block;var add_to_wishlist;var cr=String.fromCharCode(10);var wish_header_block='<div id="wish_header" class="wish_item">'+cr+'<div></div>'+cr+'<div>Фото</div>'+cr+'<div>Наименование</div>'+cr+'<div>Категория</div>'+cr+'<div>Цена</div>'+cr+'<div>Добавить</div>'+cr+'</div>'+cr;var wish_block='<div class="wishlist">'+cr+wish_header_block+'<div id="no_wish" class="wish_item"><div>Ни один товар не был добавлен в список желаемых</div></div>'+cr+'</div>'+cr;function addwish_show_change(){var new_action_block = browse_wishlist_block.find('.new_action_block').first();var result_block = browse_wishlist_block.find('.result_block').first();add_to_wishlist.fadeOut(200, function () {	result_block.fadeIn(200, function () {		result_block.delay(1000).fadeOut(200, function () {			new_action_block.fadeIn(200);		});	});});//      browse_wishlist_block.fadeIn( 200 , function(){//            browse_wishlist_block.children().first().delay(1600).fadeOut( 600 , function(){//                    browse_wishlist_block.find('.view_wish_list').fadeIn( 600 );//            });//      });} // The end of addwish_show_change       jQuery(document).ready(function($){var wish_compare = new RasoloWishCompare();/*console.log('wish_cmpr_object:');console.log(wish_compare);console.log('2018 get_error_code'+wish_compare.get_error_code());console.log('2019 get_error_msg'+wish_compare.get_error_msg());wish_compare.remove_wish(25);var wish_array_from_cookies = wish_compare.get_wish();var cmpr_array_from_cookies = wish_compare.get_cmpr();console.log('wish_array_from_cookies:');console.log(wish_array_from_cookies);console.log('cmpr_array_from_cookies:');console.log(cmpr_array_from_cookies);//var wish_array_addition_result = wish_compare.add_wish(9489);//console.log('wish_addition_result:'+wish_array_addition_result);//var wish_array_removing_result = wish_compare.remove_wish(9489);//console.log('wish_array_removing_result:'+wish_array_removing_result);console.log('2018 get_error_code'+wish_compare.get_error_code());console.log('2019 get_error_msg'+wish_compare.get_error_msg());var writing_cookies_result = wish_compare.write_cookies();console.log('writing_cookies_result:'+writing_cookies_result)throw new Error('Cookies test exit');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(24);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(25);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(26);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(27);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(28);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(29);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(30);console.log('wish_addition_result:');console.log(wish_array_addition_result);var wish_array_addition_result = wish_compare.add_wish(31);var wish_array_addition_result = wish_compare.add_wish(32);var cmpr_array_addition_result = wish_compare.add_cmpr(33);var cmpr_array_addition_result = wish_compare.add_cmpr(232);var cmpr_array_addition_result = wish_compare.add_cmpr(233);var cmpr_array_addition_result = wish_compare.get_error_code();//var cmpr_array_addition_result = wish_compare.add_cmpr(231);//wish_compare.remove_cmpr(231);//wish_compare.write_cookies();//var error_code =...//var error_msg =...console.log('cmpr_addition_result:');console.log(cmpr_array_addition_result);console.log('wish_addition_result:');console.log(wish_array_addition_result);console.log('wish_compare addition.error_code '+wish_compare.error_code);console.log('From external addition: wish_compare.error_msg '+wish_compare.error_msg);throw new Error('Temporary exit');//console.log(wish_header_block);//console.log(wish_block);*/$( ".remove_from_wishlist" ).click(function(event) {    event.preventDefault();    var event_target_i=$(event.target);    var event_target=event_target_i.parent();//    console.log(event_target);    var row_target=event_target.parent().parent();    var top_wishlist=row_target.parent();//    console.log('removing!');    var rm_elm_id=row_target.attr('id');    var rm_item_id=false;    if(rm_elm_id.substr(0,10)=='wish-item-'){        rm_item_id=rm_elm_id.substr(10);//        console.log(rm_item_id);//    } else {//        console.log('Error!'+rm_elm_id.substr(0,10));    }    var rm_item_id_num=parseInt(rm_item_id);    if(rm_item_id_num>0){        var arr = {prod_id:rm_item_id_num, wh_cmp_action:"remove_from_wish"};        var serializedArr = $.param(arr);        if(parseInt(rasolo_params.this_user)>0){            $.ajax({                  type: "POST",                  url: rasolo_params.theme_url+"wish_list_reply.php",                  data: serializedArr,                  success: function(msg) {    //                  console.log('It returned something after item removing:'+msg+'{==');                      var msg_arr=msg.split('@@@rasolo_sep@@@');                      if(isset(msg_arr[1])){    //                      console.log(msg_arr);                          try {                              var returned_parms=JSON.parse(msg_arr[0]);                          } catch (_error){                              console.log('Error 2082! The msg arr is '+msg_arr[0]+'{==');                              returned_parms=false;                          }//                          console.log(returned_parms);                          var debug_msg=msg_arr[1];                      } else {                            var debug_msg=msg_arr[0];                      };    //                  console.log(debug_msg);    //                  row_target.remove();                      row_target.hide('slow', function(){ row_target.remove().each(                          function() {    // console.log('Wishlist has as many as '+top_wishlist.children().length+' children');    // console.log('The Wishlist children html is '+top_wishlist.children().first().html()+' !!!');    // console.log(top_wishlist.get( 0 ));    // console.log('Wishlist name is '+top_wishlist.get(0).tagName+' !');                      if(top_wishlist.children().length<2){                          top_wishlist.html(wish_block);                      };                                     }                      ); });                      remove_ajax_handlers();                  //alert ('msg='+msg+'{==');    //                        remove_ajax_handlers();    //                        $('#note_jquery').html(msg);    //                        document.getElementById('contacts').innerHTML='';                  }            });        } else {            wish_compare.remove_wish(rm_item_id_num);            var after_some_item_emove_rc=wish_compare.write_cookies();//            console.log('after_some_item_emove_rc'+after_some_item_emove_rc);            var cookie_rm_success=wish_compare.get_error_code();//            console.log('After removing rm_item_id_num, error_code'+wish_compare.get_error_code());//            console.log('After removing rm_item_id_num, error_msg'+wish_compare.get_error_msg());             if(!cookie_rm_success){//                      console.log('cookie_rm_success');                  row_target.hide('slow', function(){ row_target.remove().each(                      function() {                  if(top_wishlist.children().length<2){                      top_wishlist.html(wish_block);                  }                                 }                  ); });                  remove_ajax_handlers();             }        }    }});// Add to wishlist/compare software$( ".put_to_wishlist" ).click(function(event) {//	console.log('Returning...2342');//	return;    event.preventDefault();//        var tn=$(event.target).parent().prop("tagName");//        var tn = $(event.target).parents().map(function() {//            return this.tagName;//        }).get().join( ", " );    var post_id=false;    var event_target=$(event.target);    if(rasolo_params.page_type=='shop'){        var product_parent_li=event_target.            parents().            filter('li').            first();	    browse_wishlist_block = product_parent_li.		    find('.rasolo_added_browse_wishlist_block').		    first();	    add_to_wishlist = product_parent_li.		    find('.rasolo_add_to_wishlist_block').		    first();	    var product_img_obj = product_parent_li.		    find('img.wp-post-image').		    first();	    $(event_target).            parents().            filter('li').            first().            attr('class').            split(' ').            map(function(cls){            if(cls.substr(0,5)=='post-'){                post_id=cls.substr(5);            }//            console.log(cls.substr(1, 4));        });    } else if(rasolo_params.page_type=='product') {        var product_parent_li=event_target.closest('div.product');	    browse_wishlist_block = product_parent_li.		    find('.rasolo_added_browse_wishlist_block').		    first();	    add_to_wishlist= product_parent_li.		    find('.rasolo_add_to_wishlist_block').		    first();	    var product_img_obj = product_parent_li.		    find('img.wp-post-image').		    first();	    var id_prod_elm=$(event_target).                parents().closest('div.product').                attr('id');        if(id_prod_elm.substring(0,8)=='product-'){            post_id=parseInt(id_prod_elm.substring(8));//            console.log('id_prod_elm='+id_prod_elm+', post_id='+post_id);        } else {            throw new Error('Incorrect product DOM logic');        }    } else {	    var product_parent_li = event_target.closest('div.product');	    browse_wishlist_block = event_target.closest('div.product').		    find('.rasolo_added_browse_wishlist_block').		    first();	    add_to_wishlist = event_target.closest('div.product').		    find('.rasolo_add_to_wishlist_block').		    first();	    var product_img_obj = event_target.closest('div.product').		    find('img.attachment-woocommerce_thumbnail').		    first();	    post_id= event_target.attr('data-product-id');//	    console.log('mainpage! post_id:'+post_id);//	    console.log(event_target);//        throw new Error('Incorrect wish page type');    }    var post_id_num=parseInt(post_id);//	console.log('Now the post_id='+ post_id_num);    if(post_id_num>0){        var info_wishlist=product_parent_li.            find('.wish_ajax_result').            first();//        var product_img_obj=product_parent_li.//            children('a:first-child').//            first().//            children('img:first-child');        product_img_obj.fadeTo( "fast", 0.33 );        var loader_size=44;        var prod_img_width=product_img_obj.width();        var prod_img_height=product_img_obj.height();        var left_offset= parseInt((prod_img_width-loader_size)/2).toString();        var top_offset= parseInt((prod_img_height-loader_size)/2).toString();        product_img_obj.next().show();//            console.log ('add_to_wishlist ==}'+post_id+'{==, rasolo_params.theme_url ==}'+theme_path+'{==');//            var arr = [ 1, 2, 3 ];        var arr = {prod_id:post_id_num, wh_cmp_action:"add_to_wish", age:46};//            var serializedArr = JSON.stringify( arr );        var serializedArr = $.param(arr);        if(parseInt(rasolo_params.this_user)>0){            $(document).ajaxSend(function(event, request, settings) {                product_img_obj.after('<img class="ajax_loader" style="left:'+                    left_offset+'px; top:'+                    top_offset+'px;" src="'+                    rasolo_params.theme_url+'img/ajax-loader.gif">');            });            $(document).ajaxComplete(function(event, request, settings) {                jQuery('.ajax_loader').remove();            });            $.ajax({                  type: "POST",                  url: rasolo_params.theme_url+"wish_list_reply.php",                  data: serializedArr,                  success: function(msg) {    //                  console.log('It returned something after item addition:'+msg+'{==');                      jQuery('.ajax_loader').remove();                      jQuery(document).unbind("ajaxComplete");                      jQuery(document).unbind("ajaxSend");                      var msg_arr=msg.split('@@@rasolo_sep@@@');                      if(isset(msg_arr[1])){//                          console.log(msg_arr);                          try {                              var returned_parms=JSON.parse(msg_arr[0]);                          } catch (_error){                              console.log('Error 2083! the msg arr is'+msg_arr[0]+'{==');                              returned_parms=false;                          }//                          console.log(returned_parms);                          if(parseInt(returned_parms.added_item)>=0){                              info_wishlist.removeClass('operation_failed');                              info_wishlist.addClass('operation_success');    //                          console.log('Good');//                              event_target.parent().hide();    //                          if('array_is_full')                              info_wishlist.html('№ '+post_id_num+' добавлен');                          } else if(returned_parms.error) {                              info_wishlist.removeClass('operation_success');                              info_wishlist.addClass('operation_failed');    //                          console.log('Overflow :(');//                              console.log('returned_parms:');//                              console.log(returned_parms);                              event_target.parent().hide();    //                          if('array_is_full')                              if(returned_parms.error==405){                                    info_wishlist.html('Максимум '+rasolo_params.wish_max+' шт.');                                    $('.view_wish_list').text('Чистить желания');                              } else if(returned_parms.error==404) {                                    info_wishlist.html('Товар уже был в списке');                              } else  {                                    info_wishlist.html('Ничего не получилось');                              };                          } else {                              console.log('Bad unknown error!');                              info_wishlist.html('Неизвестная ошибка!_002!');                          }                          addwish_show_change();                          var debug_msg=msg_arr[1];                      } else {                          var debug_msg=msg_arr[0];                      };    //                  console.log(debug_msg);                      // , function(){ row_target.remove(); }                      product_img_obj.fadeTo( "fast", 1. );                      remove_ajax_handlers();                  //alert ('msg='+msg+'{==');    //                        remove_ajax_handlers();    //                        $('#note_jquery').html(msg);    //                        document.getElementById('contacts').innerHTML='';                  }            });        } else if(navigator.cookieEnabled) {            product_img_obj.delay(500).fadeTo( "fast", 1.);            product_img_obj.after('<img class="ajax_loader" style="left:'+                    left_offset+'px; top:'+                    top_offset+'px;" src="'+                    rasolo_params.theme_url+'assets/images/ajax-loader.gif">');//            console.log('Let us write cookie');            var new_item_add_rc=wish_compare.add_wish(post_id_num);            var after_wish_addition_rc=wish_compare.get_error_code();//            console.log('new_item_add_rc='+new_item_add_rc);//            console.log('After addition post_id_num, error_code'+after_wish_addition_rc);//            console.log('After addition post_id_num, error_msg'+wish_compare.get_error_msg());            var after_new_item_write_rc=wish_compare.write_cookies();//            console.log('after_new_item_write_rc='+after_new_item_write_rc);            var after_write_addition_errnum=wish_compare.get_error_code();//            console.log('After writing addition results, error_code'+after_write_addition_errnum);//            console.log('After writing addition results, error_msg'+wish_compare.get_error_msg());//            var prod_id=get_my_cookie('prod_id');//            if(new_item_add_rc){            if(!after_wish_addition_rc && !after_write_addition_errnum){                info_wishlist.html('№ '+post_id_num+' добавлен');                info_wishlist.removeClass('operation_failed');                info_wishlist.addClass('operation_success');            } else if(after_wish_addition_rc==501) {                info_wishlist.html('Максимум: '+wish_compare.get_options().wish_cpcty+' шт.');  // rasolo_params.wish_max                info_wishlist.removeClass('operation_success');                info_wishlist.addClass('operation_failed');            } else if(after_wish_addition_rc==503) {                info_wishlist.html('№ '+post_id_num+' уже в списке');                info_wishlist.removeClass('operation_success');                info_wishlist.addClass('operation_failed');            } else if(after_wish_addition_rc==502) {                info_wishlist.html('Неверные данные: '+after_write_addition_errnum+'!');                info_wishlist.removeClass('operation_success');                info_wishlist.addClass('operation_failed');            } else {                info_wishlist.html('Неизвестная ошибка ('+post_id_num+')');                info_wishlist.removeClass('operation_success');                info_wishlist.addClass('operation_failed');            }            event_target.parent().hide();//            console.log('prod_id_sdn_encoded='+prod_id_sdn_encoded+'{==');//            console.log('------The beginning---------document.cookie');//            console.log(document.cookie);//            console.log('---------The end--document.cookie');            addwish_show_change();	        product_img_obj.promise().done( function() {                $('.ajax_loader').remove();            } );        } else {//            console.log('Let us call session');        }    }//	console.log('product_img_obj:');//	console.log(product_img_obj);//	throw new Error('Stopped to watch ajaxloader6');//	$('.blockUI').remove();});//    $(document).ajaxSend(function(event, request, settings) {//        console.log('itwassent!!!');//        document.getElementById(trigger_switch[wnd]).innerHTML='<img src=/images/ajax_loader.gif>';//    });       });  // The end of JQuery.ready